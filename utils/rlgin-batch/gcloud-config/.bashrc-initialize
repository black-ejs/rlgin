
# >>> RLGIN_BATCH initialize >>>
# echo rlgin batch initialization
export RLGIN_BATCH_EXECUTION_BUCKET='rb-t-shared-bucket-1'
export RLGIN_BATCH_REPO_URL='https://github.com/black-ejs/rlgin'
export RLGIN_BATCH_LOCAL_REPO=~/rlgin-local-repo
export RLGIN_BATCH_SERIES_ROOT=~/dev
export RLGIN_BATCH_SERIES_BASE="${RLGIN_BATCH_SERIES_ROOT}"/projects/training_ground
export RLGIN_BATCH_PARAMS="${RLGIN_BATCH_SERIES_ROOT}"/projects/rlgin-batch/job-params

gfps=`ps -ef | grep gcsfuse | grep -v grep`
if [[ X"${gfps}"X == XX  ]] 
then
        # echo "ps looking for gcsfuse did not find it, gfps=${gfps}"
        if [ ! -d ${RLGIN_BATCH_SERIES_ROOT} ]
        then
                other_dev=`ls -latr ~ | grep dev` 
                if [[ "X${other_dev}X" == XX ]]
                then
                        # echo ~/dev is there but is not a directory
                        # echo dismounting
                        fusermount -u "${RLGIN_BATCH_SERIES_ROOT}" 
                fi
                if [ ! -d ${RLGIN_BATCH_SERIES_ROOT} ]
                then
                        # echo ~/dev should be removed, re-creating
                        mkdir -p ${RLGIN_BATCH_SERIES_ROOT}
                fi
        fi
        dev_contents=`ls ${RLGIN_BATCH_SERIES_ROOT}`
        if [[ "X${dev_contents}X" == XX ]]
        then
                # echo "${RLGIN_BATCH_SERIES_ROOT} is empty"
                # echo "rlgin-batch: mounting shared bucket"
                gcsfuse --debug_fuse --debug_fs --debug_gcs --file-mode 744 "${RLGIN_BATCH_EXECUTION_BUCKET}" "${RLGIN_BATCH_SERIES_ROOT}"
                #### gcsfuse --debug_fuse --debug_fs --debug_gcs --stat-cache-ttl 0 --type-cache-ttl 0 --file-mode 744 "${RLGIN_BATCH_EXECUTION_BUCKET}" "${RLGIN_BATCH_SERIES_ROOT}"
                # unmount with  
                #       fusermount -u "${RLGIN_BATCH_SERIES_ROOT}"
        # else
                # echo "${RLGIN_BATCH_SERIES_ROOT} is not empty:"
                # echo "${dev_contents}"

        fi
fi
# <<< RLGIN BATCH initialize <<<
